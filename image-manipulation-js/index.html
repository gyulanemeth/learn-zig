<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Image Manipulation Reference Implementation</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.3.17/dist/vuetify.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@3.3.17/dist/vuetify.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
  </head>
  <body>
    <div id="app">
      <v-layout class="rounded rounded-md">
        <v-navigation-drawer permanent>
          <v-list>
            <v-list-item title="Yo"></v-list-item>
          </v-list>
          <template v-slot:append>
            <v-card v-if="imgData">
              <v-card-subtitle>Selection</v-card-subtitle>
              <v-card-text>
                <canvas style="border: 1px solid gray; width: 100%"></canvas>
              </v-card-text>
            </v-card>
          </template>
        </v-navigation-drawer>
    
        <v-main class="d-flex align-center justify-center" style="min-height: 300px;">
          <v-container>
            <v-row>
              <v-col>
                <v-toolbar
                flat
                density="compact"
                :elevation="1"
                >
                  <v-btn-toggle>
                    <v-btn icon>
                      <v-icon>mdi-select-drag</v-icon>
                    </v-btn>
                    <v-btn icon>
                      <v-icon>mdi-brush</v-icon>
                    </v-btn>
                    <v-btn icon>
                      <v-icon>mdi-palette</v-icon>
                    </v-btn>
                  </v-btn-toggle>
                  <v-spacer></v-spacer>
                  <v-select
                    style="max-width: 130px;"
                    v-model="toolbar.zoom.value"
                    :items="toolbar.zoomValues"
                    hide-details
                    flat
                    prepend-inner-icon="mdi-magnify-plus-outline"
                  ></v-select>
                </v-toolbar>
              </v-col>
            </v-row>
            <v-row>
              <v-col class="d-flex justify-center align-center">
                <canvas v-draw-image="imgSrc" :style="{ transform: `scale(${parseInt(toolbar.zoom.value.replace('%', '')) / 100})` }"></canvas>
              </v-col>
            </v-row>
          </v-container>
        </v-main>
      </v-layout>
    </div>
    <script>
      const { createApp, ref } = Vue
      const { createVuetify } = Vuetify

      const vuetify = createVuetify()

      const imgData = ref(null)
      const selectionImgData = ref(null)

      createApp({
        setup() {
          const imgSrc = ref('./lena.png')
          const zoom = ref('100%')
          return {
            toolbar: {
              zoom,
              zoomValues: ['100%', '75%', '50%', '25%']
            },
            imgSrc

          }
        },
        directives: {
          'draw-image': {
            async updated(el, binding, vnode, prevVnode) {
              const imgHandler = await import('./image-handling.js')
              const img = await imgHandler.loadImg(binding.value)
              imgData.value = img
              imgHandler.drawImageToCanvas(el, img)
            }
          }
        }
      }).use(vuetify).mount('#app')
    </script>
  </body>
</html>
